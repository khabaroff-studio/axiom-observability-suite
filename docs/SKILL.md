# Навык: alertbot-routes

Короткий гид для LLM по конфигурации alertbot через `routes.yml`.
Цель — низкий шум и понятные, actionable сообщения.

## Цель

- Декларативно описывать маршрутизацию, фильтры и формат алертов
- Валидировать схему и плейсхолдеры на старте сервиса
- Держать когнитивную нагрузку минимальной

## Входы

- `routes.yml` — рабочая конфигурация (локально на сервере)
- `routes.yml.example` — публичный шаблон, валидируется в CI
- `routes.schema.json` — JSON Schema

## Выход

- Сообщение в Telegram с тегом `#user-impact` или `#service-errors`
- Контекст: host:service, count + окно, top error, sample строки
- Общий runbook для быстрого triage

## Правила

- Если `routes.yml` не проходит схему или плейсхолдеры — сервис должен упасть
- Разрешенные плейсхолдеры в runbook: `{host}`, `{service}`, `{monitor}`
- Шумовые события удаляются полностью (`drop`)
- P1 определяется по профилям (`profiles`)
- Профили назначаются явно в `services`

## Минимальная схема YAML

- `groups`, `topics`, `routes`, `default_group`, `default_topic`
- `tags`, `defaults`, `drop`, `profiles`, `services`

## Как интерпретировать алерт

1) Применить `drop` фильтры — если совпало, алерт не отправлять
2) Найти профили сервиса → если совпало с `p1`, тег `#user-impact`
3) Иначе тег `#service-errors`
4) Собрать сообщение по дефолтам (count/окно/top error/sample/runbook)

## Пример runbook (общий)

- "Зайди по SSH на {host}"
- "Проверь логи контейнера {service}: docker logs {service} --tail 200"

## Рекомендации

- Не добавлять сложные правила, если это не нужно
- Сначала решить проблему шумов, потом улучшать формат
- Для ошибок без payload лучше использовать enrichment (доп. запрос в Axiom)
